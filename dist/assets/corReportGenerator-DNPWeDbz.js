import{B as N}from"./index-D2DBcvGk.js";const h={hse:{policies:[{code:"HSE1022",name:"Health & Safety Pledge"},{code:"HSE1023",name:"Commitment Statement"},{code:"HSE1024",name:"Workers Rights"},{code:"HSE1025",name:"Safety Management System"},{code:"HSE1026",name:"Certifications & Qualifications"},{code:"HSE1027",name:"Health & Safety Policy"},{code:"HSE1028",name:"Personal Protective Equipment"},{code:"HSE1029",name:"Vehicle Safety"},{code:"HSE1030",name:"COVID-19 Policy"},{code:"HSE1031",name:"Pandemic Disease Policy"},{code:"HSE1032",name:"Open Communication"},{code:"HSE1033",name:"Drug & Alcohol Policy"},{code:"HSE1034",name:"Refuse Unsafe Work"},{code:"HSE1035",name:"Harassment & Violence"},{code:"HSE1036",name:"Environmental Policy"},{code:"HSE1037",name:"Security Policy"},{code:"HSE1038",name:"Waste Disposal"},{code:"HSE1039",name:"Fatigue Management"},{code:"HSE1040",name:"Company Rules"},{code:"HSE1041",name:"General Safety Rules"},{code:"HSE1042",name:"Grounds for Dismissal"},{code:"HSE1043",name:"Public & Visitors Policy"},{code:"HSE1044",name:"Contractors Policy"},{code:"HSE1045",name:"Employer Duties"},{code:"HSE1046",name:"Part 13 Code Requirements"},{code:"HSE1047",name:"Hazard Assessment Policy"},{code:"HSE1048",name:"Hazard Control Policy"},{code:"HSE1049",name:"Inspection Policy"},{code:"HSE1050",name:"Preventative Maintenance"},{code:"HSE1051",name:"Emergency Response Policy"},{code:"HSE1052",name:"Investigations Policy"},{code:"HSE1053",name:"Systems Overview & Audit"}]},rpas:{policies:[{code:"RPAS1001",name:"Team Competencies"},{code:"RPAS1002",name:"Roles & Responsibilities"},{code:"RPAS1003",name:"Airworthiness & Maintenance"},{code:"RPAS1004",name:"Personal Protective Equipment"},{code:"RPAS1005",name:"General Procedures"},{code:"RPAS1006",name:"Emergency Procedures"},{code:"RPAS1007",name:"Communication Protocol"},{code:"RPAS1008",name:"Detect, Avoid & Separate"},{code:"RPAS1009",name:"Minimum Weather Requirements"},{code:"RPAS1010",name:"Incident & Accident Reporting"},{code:"RPAS1011",name:"Site Survey & Flight Plan"},{code:"RPAS1012",name:"Equipment Testing"}],procedures:[{id:"RPAS-GP-001",name:"General Procedures",version:"V25_01"},{id:"RPAS-EP-001",name:"Emergency Procedures",version:"V25_01"},{id:"RPAS-AP-001",name:"Advanced Procedures",version:"V25_01"},{id:"RPAS-SS-001",name:"Site Survey & Flight Plan",version:"V25_01"}]},crm:{policies:[{code:"CRM1013",name:"Threat & Error Management"},{code:"CRM1014",name:"Communication"},{code:"CRM1015",name:"Situational Awareness"},{code:"CRM1016",name:"Pressure & Stress Management"},{code:"CRM1017",name:"Fatigue Management"},{code:"CRM1018",name:"Workload Management"},{code:"CRM1019",name:"Decision Making Process"},{code:"CRM1020",name:"Leadership & Team Building"},{code:"CRM1021",name:"Automation & Technology"}]}};function D(o){var v;const{incidents:r=[],capas:m=[],forms:d=[],operators:p=[],projects:y=[],aircraft:S=[]}=o,a=new Date,A=new Date(a.getFullYear(),0,1),P=r.filter(t=>{var s;return((s=t.dateOccurred)!=null&&s.toDate?t.dateOccurred.toDate():new Date(t.dateOccurred))>=A}),e=P.filter(t=>t.type!=="near_miss"&&t.type!=="observation"),f=P.filter(t=>t.type==="near_miss"),C=P.filter(t=>t.category==="flight"||t.category==="rpas");let u=null;if(e.length>0){const t=[...e].sort((s,R)=>{var M,O;const E=(M=s.dateOccurred)!=null&&M.toDate?s.dateOccurred.toDate():new Date(s.dateOccurred);return((O=R.dateOccurred)!=null&&O.toDate?R.dateOccurred.toDate():new Date(R.dateOccurred))-E}),c=(v=t[0].dateOccurred)!=null&&v.toDate?t[0].dateOccurred.toDate():new Date(t[0].dateOccurred);u=Math.floor((a-c)/(1e3*60*60*24))}const l={};d.forEach(t=>{l[t.templateId||"unknown"]=(l[t.templateId||"unknown"]||0)+1});const g=t=>{const c=d.filter(R=>t.some(E=>(R.templateId||"").includes(E))),s=c.filter(R=>R.status==="completed");return c.length>0?Math.round(s.length/c.length*100):100},i=m.filter(t=>!["closed","verified_effective"].includes(t.status)),n=m.filter(t=>["closed","verified_effective"].includes(t.status)),w=i.filter(t=>{var s;return t.targetDate?((s=t.targetDate)!=null&&s.toDate?t.targetDate.toDate():new Date(t.targetDate))<a:!1}),H=p.filter(t=>Array.isArray(t.certifications)&&t.certifications.length>0),T=p.length>0?Math.round(H.length/p.length*100):100,b=S.filter(t=>["active","operational","CLEAR","airworthy"].includes(t.status)),I=S.filter(t=>["LOCKOUT","grounded"].includes(t.status));return{trainingCompletionRate:T,certCurrencyRate:T,inspectionCompletionRate:g(["inspection"]),flhaCompletionRate:g(["flha","field_level"]),preflightCompletionRate:g(["preflight","pre_flight"]),daysSinceIncident:u,ytdRecordableIncidents:e.length,ytdNearMisses:f.length,ytdFlightIncidents:C.length,openCapas:i.length,closedCapas:n.length,overdueCapas:w.length,capaClosureRate:m.length>0?Math.round(n.length/m.length*100):100,capaOnTimeRate:n.length>0?Math.round(n.filter(t=>{var c;return((c=t.metrics)==null?void 0:c.onTime)!==!1}).length/n.length*100):100,totalAircraft:S.length,activeAircraft:b.length,lockedOutAircraft:I.length,equipmentAvailability:S.length>0?Math.round(b.length/S.length*100):100,totalForms:d.length,completedForms:d.filter(t=>t.status==="completed").length,formCounts:l,totalOperators:p.length,totalProjects:y.length,activeProjects:y.filter(t=>t.status==="active"||t.status==="in_progress").length}}function F(o){let r=0;return r+=(o.trainingCompletionRate||100)/100*15,r+=(o.inspectionCompletionRate||100)/100*10,r+=(o.flhaCompletionRate||100)/100*15,r+=(o.ytdNearMisses||0)>=5?10:(o.ytdNearMisses||0)>=1?5:0,r+=(o.capaClosureRate||100)/100*15,r+=(o.capaOnTimeRate||100)/100*10,r+=o.daysSinceIncident===null?15:o.daysSinceIncident>=90?12:o.daysSinceIncident>=30?6:3,r+=Math.min((o.totalForms||0)/50*10,10),Math.round(r)}async function k(o,r={}){const{branding:m=null,includeAppendices:d=!0}=r,{operators:p=[],projects:y=[],aircraft:S=[]}=o,a=D(o),A=F(a),P=new Date().getFullYear(),e=new N({title:"COR Safety Program Report",subtitle:`Annual Audit Documentation - ${P}`,projectName:"Safety Program Review",projectCode:`COR-${P}`,branding:m});await e.init(),e.addCoverPage(),e.addTableOfContents(),e.addNewSection("Executive Summary"),e.addParagraph("This report documents Aeria Solutions Ltd.'s integrated safety management system for COR audit purposes. The program encompasses 53 policies across three domains: Health, Safety & Environment (32), RPAS Operations (12), and Crew Resource Management (9), plus 4 detailed operational procedures."),e.addSpacer(8),e.addSubsectionTitle("Program Overview"),e.addTable(["Domain","Count","Regulatory Alignment"],[["HSE Policies","32","BC OHS Regulation, WorkSafeBC"],["RPAS Policies","12","CARs Part IX, SORA 2.5"],["CRM Policies","9","TC AC 700-042"],["Procedures","4","Internal SOPs"]]),e.addSpacer(5),e.addSubsectionTitle("Audit Readiness"),e.addKPIRow([{label:"Overall Score",value:String(A)+"%"},{label:"Incident-Free Days",value:a.daysSinceIncident!==null?String(a.daysSinceIncident):"N/A"},{label:"YTD Incidents",value:String(a.ytdRecordableIncidents)},{label:"Open CAPAs",value:String(a.openCapas)}]),e.addNewSection("Management Leadership"),e.addSubsectionTitle("Foundational Policies"),e.addTable(["Code","Policy","Purpose"],[["HSE1022","Health & Safety Pledge","Zero harm commitment"],["HSE1023","Commitment Statement","Leadership accountability"],["HSE1024","Workers Rights","Know, participate, refuse"],["HSE1025","Safety Management System","ISO 45001 aligned"],["HSE1027","Health & Safety Policy","Core H&S statement"]]),e.addSpacer(5),e.addSubsectionTitle("Organizational Roles"),e.addTable(["Role","Safety Responsibility"],[["Accountable Executive","Overall program accountability and resource allocation"],["Operations Manager","Day-to-day implementation and compliance"],["Pilot in Command","Flight operation authority and crew safety"],["Visual Observer","Airspace monitoring and situational awareness"]]),e.addNewSection("Hazard Assessment"),e.addSubsectionTitle("Assessment Methods"),e.addTable(["Method","Frequency","Reference"],[["Formal Hazard Assessment","New sites / major changes","HSE1047"],["Field-Level Hazard Assessment","Every operation","HSE1047"],["Site Survey","Per operational area","RPAS1011"],["SORA Risk Assessment","Per flight operation","SORA 2.5"],["Threat & Error Management","Pre-flight briefings","CRM1013"]]),e.addSpacer(5),e.addSubsectionTitle("Risk Control"),e.addParagraph("Hierarchy of Controls: Elimination > Substitution > Engineering > Administrative > PPE"),e.addParagraph("Risk Matrix: 5x5 probability/severity assessment per HSE1048"),e.addSpacer(5),e.addSubsectionTitle("Performance Metrics"),e.addKPIRow([{label:"FLHA Rate",value:String(a.flhaCompletionRate)+"%"},{label:"Inspection Rate",value:String(a.inspectionCompletionRate)+"%"},{label:"Pre-Flight Rate",value:String(a.preflightCompletionRate)+"%"}]),e.addNewSection("Safe Work Practices"),e.addSubsectionTitle("RPAS Operational Procedures"),e.addTable(["Phase","Procedure","Key Activities"],[["Pre-Op","Planning & Briefing","Weather, NOTAMs, TEM, crew roles"],["Setup","Site & Equipment","Area inspection, RPAS assembly, checks"],["Flight","Operations","Monitoring, communication, logging"],["Post-Op","Recovery & Debrief","Landing, data backup, lessons learned"]]),e.addSpacer(5),e.addSubsectionTitle("CRM Protocols"),e.addTable(["Protocol","Reference","Application"],[["P.A.C.E. Escalation","CRM1014","Probe > Alert > Challenge > Emergency"],["Situational Awareness","CRM1015","Perception > Comprehension > Projection"],["Workload Management","CRM1018","Task prioritization and delegation"],["Decision Making","CRM1019","FOR-DEC / DODAR methodology"]]),e.addNewSection("Training & Competency"),e.addSubsectionTitle("Required Certifications"),e.addTable(["Certification","Requirement","Renewal"],[["RPAS Pilot Certificate","Basic / Advanced / Complex","Per TC requirements"],["ROC-A (Radio)","Aeronautical radio operations","5 years"],["Emergency First Aid","All operational crew","3 years"],["CRM Training","All flight crew","Annual refresher"]]),e.addSpacer(5),e.addSubsectionTitle("Current Status"),e.addKPIRow([{label:"Cert Currency",value:String(a.certCurrencyRate)+"%"},{label:"Training Complete",value:String(a.trainingCompletionRate)+"%"},{label:"Total Operators",value:String(a.totalOperators)}]),e.addNewSection("Inspections & Maintenance"),e.addSubsectionTitle("Inspection Schedule"),e.addTable(["Type","Frequency","Reference"],[["Workplace Inspection","Monthly","HSE1049"],["Pre-Flight Inspection","Every operation","RPAS1003"],["Equipment Testing","New / Annual / Post-repair","RPAS1012"],["Vehicle Inspection","Daily (pre-use)","HSE1029"],["PPE Inspection","Before each use","HSE1028"]]),e.addSpacer(5),e.addSubsectionTitle("Equipment Status (CLEAR/LOCKOUT System)"),e.addKPIRow([{label:"Availability",value:String(a.equipmentAvailability)+"%"},{label:"Active Units",value:String(a.activeAircraft)},{label:"Locked Out",value:String(a.lockedOutAircraft)}]),e.addNewSection("Incident Management"),e.addSubsectionTitle("Reporting Requirements"),e.addTable(["Authority","Timeframe","Trigger Events"],[["Internal","24 hours","All incidents, near misses, observations"],["Transport Canada","Per CAR 901.49","Reportable RPAS occurrences"],["WorkSafeBC","Immediately","Serious injury, fatality"],["TSB","Immediately","Fatality, mid-air collision risk"]]),e.addSpacer(5),e.addSubsectionTitle("YTD Statistics"),e.addTable(["Metric","Actual","Target","Status"],[["Recordable Incidents",String(a.ytdRecordableIncidents),"0",a.ytdRecordableIncidents===0?"MET":"NOT MET"],["Flight Incidents",String(a.ytdFlightIncidents),"0",a.ytdFlightIncidents===0?"MET":"NOT MET"],["Near Miss Reports",String(a.ytdNearMisses),">=5",a.ytdNearMisses>=5?"MET":"REVIEW"]]),e.addSpacer(5),e.addSubsectionTitle("CAPA Performance"),e.addKPIRow([{label:"Open",value:String(a.openCapas)},{label:"Overdue",value:String(a.overdueCapas)},{label:"Closure Rate",value:String(a.capaClosureRate)+"%"},{label:"On-Time",value:String(a.capaOnTimeRate)+"%"}]),e.addNewSection("Emergency Response"),e.addSubsectionTitle("RPAS Emergency Procedures"),e.addTable(["Scenario","Primary Response","Reference"],[["Control Station Failure","Activate backup / RTH","RPAS-EP-001"],["RPAS System Failure","Emergency landing / FTS","RPAS-EP-001"],["Fly-Away Event","Track, notify ATC, recover","RPAS-EP-001"],["C2 Link Loss","Automated failsafe activation","RPAS-EP-001"],["Crash / Collision","Scene preservation, notify","RPAS-EP-001"]]),e.addSpacer(5),e.addSubsectionTitle("Emergency Contacts"),e.addTable(["Service","Number"],[["Emergency Services","911"],["WorkSafeBC 24hr","1-888-621-7233"],["Transport Canada","1-888-463-0521"],["NAV CANADA","1-866-992-7433"]]),e.addNewSection("Records & Statistics"),e.addSubsectionTitle("Leading Indicators"),e.addTable(["Indicator","Target","Actual","Status"],[["Training Completion",">=95%",String(a.trainingCompletionRate)+"%",a.trainingCompletionRate>=95?"MET":"NOT MET"],["Inspection Completion","100%",String(a.inspectionCompletionRate)+"%",a.inspectionCompletionRate>=100?"MET":"NOT MET"],["FLHA Completion","100%",String(a.flhaCompletionRate)+"%",a.flhaCompletionRate>=100?"MET":"NOT MET"],["Near Miss Reporting",">=5/year",String(a.ytdNearMisses),a.ytdNearMisses>=5?"MET":"REVIEW"]]),e.addSpacer(5),e.addSubsectionTitle("Form Statistics");const f=Object.entries(a.formCounts||{});if(f.length>0){const C=f.sort((u,l)=>l[1]-u[1]).slice(0,8).map(([u,l])=>[u.replace(/_/g," ").replace(/\b\w/g,g=>g.toUpperCase()),String(l)]);e.addTable(["Form Type","Count"],C)}else e.addParagraph("No forms recorded in current period.");if(e.addNewSection("Program Administration"),e.addSubsectionTitle("Document Control"),e.addTable(["Element","Practice"],[["Version Control","All policies tracked with revision history"],["Review Cycle","Annual review with documented amendments"],["Distribution","Electronic via Aeria Ops platform"],["Retention","Per regulatory requirements (min 3 years)"]]),e.addSpacer(5),e.addSubsectionTitle("Regulatory Framework"),e.addTable(["Regulation","Scope"],[["BC OHS Regulation","Workplace health and safety"],["CARs Part IX","RPAS operations"],["JARUS SORA 2.5","Operational risk assessment"],["ISO 45001:2018","SMS framework alignment"]]),d){e.addNewSection("Policy Index"),e.addSubsectionTitle("HSE Policies (32)");const C=h.hse.policies.map(i=>[i.code,i.name]);e.addTable(["Code","Name"],C,{fontSize:7}),e.addSubsectionTitle("RPAS Policies (12)");const u=h.rpas.policies.map(i=>[i.code,i.name]);e.addTable(["Code","Name"],u,{fontSize:8}),e.addSubsectionTitle("CRM Policies (9)");const l=h.crm.policies.map(i=>[i.code,i.name]);e.addTable(["Code","Name"],l,{fontSize:8}),e.addSubsectionTitle("Procedures (4)");const g=h.rpas.procedures.map(i=>[i.id,i.name,i.version]);if(e.addTable(["Code","Name","Version"],g,{fontSize:8}),p.length>0){e.addNewSection("Operator Registry");const i=p.slice(0,20).map(n=>[n.name||`${n.firstName||""} ${n.lastName||""}`.trim()||"Unknown",n.role||"Operator",n.pilotCertificate||"N/A"]);e.addTable(["Name","Role","Pilot Cert"],i)}if(S.length>0){e.addNewSection("Equipment Registry");const i=S.map(n=>[n.nickname||n.name||"Unknown",n.manufacturer||"N/A",n.model||"N/A",n.status||"Active"]);e.addTable(["Name","Manufacturer","Model","Status"],i)}if(y.length>0){e.addNewSection("Project Registry");const i=y.slice(0,15).map(n=>[n.projectCode||(n.id?n.id.substring(0,8):"N/A"),n.name||"Unknown",n.client||"N/A",n.status||"Unknown"]);e.addTable(["Code","Name","Client","Status"],i)}}return e.addNewSection("Certification"),e.addParagraph("I certify that this report accurately represents the Health, Safety & Environment program of Aeria Solutions Ltd. as of the date indicated."),e.addSpacer(15),e.addSignatureBlock([{role:"Health & Safety Manager"},{role:"Operations Manager"},{role:"Accountable Executive"}]),e.addSpacer(10),e.addParagraph(`Generated: ${new Date().toLocaleDateString("en-CA")} | TC Company File: 930355`),e}async function W(o,r={}){const m=await k(o,r),d=`COR_Safety_Report_${new Date().toISOString().split("T")[0]}.pdf`;return m.save(d),d}export{h as PROGRAM_STRUCTURE,F as calculateAuditReadinessScore,D as calculateSafetyKPIs,W as exportCORReport,k as generateCORReport};
